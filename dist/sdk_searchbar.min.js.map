{"version":3,"sources":["../src/sdk_searchbar.js"],"names":[],"mappings":"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","file":"sdk_searchbar.min.js","sourcesContent":["(() => {\n  let searchBarConfig = {};\n  let searchBarMain = null;\n  // expose global object\n  window.StockSearchBar = {\n    init: (config) => {\n      searchBarConfig = config;\n      window.addEventListener('StockSearchBarReady', () => {\n        console.log('SearchBar ready');\n        const sbm = searchBarMain();\n        window.StockSearchBar.getFilters = sbm.getFilters;\n        window.StockSearchBar.setFilters = sbm.setFilters;\n        sbm.init();\n      }, false);\n    },\n  };\n  searchBarMain = () => {\n    const AdobeStock = window.AdobeStock;\n    const SB = searchBarConfig;\n    const includePath = window.StockSearchBar.PATH;\n    function getTrackingUrl(url) {\n      // clk.tradedoubler.com/click?p(ProgramID)&a(AdvertiserID)&g(AdID)url(TARGET_URL)\n      return `//clk.tradedoubler.com/click?p(${SB.programID})a(${SB.advertiserID})g(${SB.adID})url(${encodeURIComponent(url)})`;\n    }\n    const stockHomeUrl = getTrackingUrl('https://stock.adobe.com');\n    const fmfUrl = getTrackingUrl('https://stock.adobe.com/plans');\n    const sbHeader = `<div class=\"astock-searchbar-header\"><a href=\"${stockHomeUrl}\" target=\"_blank\"><img src=\"${includePath}/adobe_stock_logo-400.png\"></a><p>First month free with <a href=\"${fmfUrl}\" class=\"astock-searchbar-link\" target=\"_blank\">Adobe Stock annual plans</a>.</p></div>`;\n    function parseFilters(filters) {\n      const searchFilters = {};\n      const $jq = window.StockSearchBar.$jq;\n      if (!filters) return;\n      // iterate over object using method that won't bother eslint!\n      const filterMap = Object.entries(filters);\n      const stkParams = AdobeStock.SEARCH_PARAMS;\n      // lookup Stock keyname and map to search filter name\n      filterMap.forEach(([key, currentValue]) => {\n        let value = currentValue;\n        if (Object.prototype.hasOwnProperty.call(stkParams, key)) {\n          if (key === 'SIMILAR_URL') {\n            if (value !== '' && value !== undefined) {\n              const firstImg = $jq(`${value} img`)[0] || $jq(`${value}`)[0];\n              const url = $jq(firstImg).attr('src');\n              if (url !== '' && url !== undefined) {\n                searchFilters[stkParams[key]] = url;\n              }\n            }\n          } else if (key === 'WORDS') {\n            // value should be array ['DOM element', keyword count]\n            if (value && value[0]) {\n              const phrase = $jq(value[0]).text();\n              // if element has text get keywords\n              if (phrase) {\n                const keywords = window.StockSearchBar.keywordx.extract(phrase, {\n                  language: 'english',\n                  remove_digits: true,\n                  return_changed_case: true,\n                  remove_duplicates: true,\n                });\n                // if count is not supplied default to 1\n                const keywordCount = (value[1]) ? value[1] : 1;\n                const searchWords = (keywords.length > 0) ? keywords.slice(0, keywordCount).join(' ') : '';\n                console.log('keywords: %o\\nsearching on %s', keywords, searchWords);\n                searchFilters[stkParams[key]] = searchWords;\n              }\n            }\n          } else if (value !== '' && value !== undefined) {\n            // validate size\n            if (key === 'THUMBNAIL_SIZE') {\n              const sizes = [110, 160, 220, 240, 500, 1000];\n              const targetSize = value;\n              // check if size is in array of allowed sizes\n              if (sizes.indexOf(targetSize) < 0) {\n                value = sizes.reduce((a, b) => {\n                  const newSize = (Math.abs(a - targetSize) < Math.abs(b - targetSize) ? a : b);\n                  return newSize;\n                });\n                console.warn('Thumbnail size of %s is not valid. Closest size is %s', targetSize, value);\n              }\n            }\n            searchFilters[stkParams[key]] = value;\n          }\n        }\n      });\n      return searchFilters;\n    }\n    // returns container div from selector and adds main class\n    function $getContDiv(el) {\n      const mainClass = 'astock-searchbar';\n      const dataId = 'searchbar';\n      // get reference to jQuery\n      const $jq = window.StockSearchBar.$jq;\n      // get reference to target div and data node (might be same)\n      let $tempDiv = $jq(el);\n      const $dataDiv = $tempDiv.find(`[data-id=${dataId}]`);\n      // if data node exists, return it\n      if ($dataDiv.length > 0) {\n        $tempDiv = $dataDiv;\n      // does target node exist\n      } else if ($tempDiv.length > 0) {\n        // does target node contain main class\n        if (!$tempDiv.hasClass(mainClass)) {\n          // create new div to be container\n          const $mainDiv = $jq(document.createElement('div'));\n          // add main class\n          $mainDiv.addClass(mainClass);\n          // add new container under target and return that\n          $tempDiv = $mainDiv;\n          $jq(el).append($tempDiv);\n        }\n        // add data node\n        $tempDiv.attr('data-id', dataId);\n      // neither exists, throw exception\n      } else {\n        throw (new Error('Stock SearchBar error: Container does not exist. Set \"contId\" to a valid selector.'));\n      }\n      return $tempDiv;\n    }\n    // creates thumbs and inserts -- input is json array\n    function updateUiThumbs(files) {\n      const wrapClass = 'astock-searchbar-wrap';\n      const bodyClass = 'astock-searchbar-body';\n      let itemClass = 'astock-searchbar-item';\n      const tipClass = 'astock-searchbar-tip';\n      // get reference to jQuery\n      const $jq = window.StockSearchBar.$jq;\n      const $sb = $getContDiv(SB.contId);\n      // wrap thumbnails in container to allow scrolling\n      const $wrapDiv = $jq(document.createElement('div'));\n      $wrapDiv.addClass(wrapClass);\n      const $thumbsDiv = $jq(document.createElement('div'));\n      $thumbsDiv.addClass(bodyClass);\n      // if body width is less than 150px, apply small item size\n      if ($sb.width() <= 150) {\n        itemClass = `${itemClass} item-small`;\n      }\n      // populate with images using html returned in json\n      files.forEach((asset) => {\n        // get html tag\n        const tag = asset[AdobeStock.RESULT_COLUMNS.THUMBNAIL_HTML_TAG];\n        // get url to details page on Stock and wrap inside affiliate tracking url\n        const url = getTrackingUrl(asset[AdobeStock.RESULT_COLUMNS.DETAILS_URL]);\n        // convert html string into dom element\n        const range = document.createRange();\n        const thumb = range.createContextualFragment(tag);\n        // create div wrapper\n        const div = document.createElement('div');\n        div.className = itemClass;\n        // create anchor with link to details\n        const link = document.createElement('a');\n        link.href = url;\n        link.target = '_blank';\n        // if captions are enabled\n        if (SB.tooltips) {\n          // create tool tip from image title\n          const tip = document.createElement('div');\n          tip.className = tipClass;\n          // get title text from document-fragment\n          const tipText = thumb.querySelector('img').title;\n          if (tipText !== '' && tipText !== undefined) {\n            tip.textContent = tipText;\n            thumb.querySelector('img').removeAttribute('title');\n            link.appendChild(tip);\n            // create hover behavior for tip\n            const $tip = $jq(tip);\n            const $link = $jq(link);\n            const showTip = (el) => {\n              el.stopPropagation();\n              el.preventDefault();\n              const $img = $jq(el.currentTarget);\n              const $off1 = $img.offset();\n              const $off2 = $sb.offset();\n              const newPos = {\n                top: ($off1.top - $off2.top) + $img.height(),\n                left: ($off1.left - $off2.left) + $img.width(),\n              };\n              $tip.css({\n                top: newPos.top,\n                left: newPos.left,\n              });\n              // console.log('final pos', newPos);\n              $tip.show();\n              // change parent to main div\n              $sb.append($tip);\n            };\n            const hideTip = (el) => {\n              $tip.css($jq(el.currentTarget).offset());\n              $tip.hide();\n              // reset parent to link\n              $link.append($tip);\n            };\n            // $jq(thumb.querySelector('img')).hover(showTip);\n            $jq(link).hover(showTip, hideTip);\n          }\n        }\n        // wrap link around image and add to document\n        link.appendChild(thumb);\n        div.appendChild(link);\n        $thumbsDiv.append(div);\n      });\n      $wrapDiv.append($thumbsDiv);\n      $sb.append($wrapDiv);\n      // init Masonry\n      $thumbsDiv.masonry({\n        itemSelector: `.${itemClass}`,\n      });\n      // listen for images loaded event\n      $thumbsDiv.imagesLoaded()\n        .progress(() => {\n          $thumbsDiv.masonry('layout');\n        })\n        .done(() => {\n          console.log('all images successfully loaded');\n          // show search bar\n          $sb.addClass('astock-searchbar-fadein');\n          // make sure it is visible in case class is missing\n          window.setTimeout(() => {\n            $sb.css({\n              visibility: 'visible',\n              opacity: 1,\n            });\n            // call Masonry layout one final time for Firefox!\n            $thumbsDiv.masonry('layout');\n          }, 1000);\n        });\n    }\n    // runs search using sdk\n    function doSearch(params) {\n      // default filters\n      const defaultParams = {\n        offset: 0,\n        limit: 16,\n      };\n      // merge default filters with params from config\n      const searchParams = Object.assign(defaultParams, params);\n      const queryParams = {\n        locale: 'en-US',\n        search_parameters: searchParams,\n      };\n      // result fields to get back\n      const resultColumns = [\n        AdobeStock.RESULT_COLUMNS.THUMBNAIL_HTML_TAG,\n        AdobeStock.RESULT_COLUMNS.DETAILS_URL,\n        AdobeStock.RESULT_COLUMNS.NB_RESULTS,\n      ];\n      console.log('Search query: %o', searchParams);\n      // create sdk instance\n      const stock = new AdobeStock(SB.apiKey, SB.appName, AdobeStock.ENVIRONMENT.PROD);\n      // execute search and load results\n      const iterator = stock.searchFiles(null, queryParams, resultColumns);\n      // iterate over returned Promise\n      iterator.next().then(() => {\n        const response = iterator.getResponse();\n        // only update UI if there are results\n        if (response.nb_results > 0) {\n          updateUiThumbs(response.files);\n        } else {\n          console.log('no results from Stock');\n        }\n      });\n    }\n    return {\n      init: () => {\n        const $jq = window.StockSearchBar.$jq;\n        // create search results\n        const $searchBar = $getContDiv(SB.contId);\n        // create stock header\n        const $header = $jq(sbHeader);\n        const headerUrl = $header.find('a').attr('href');\n        $searchBar.append($header);\n        // extract search options and run search\n        doSearch(parseFilters(SB.filters));\n      },\n      getFilters: () => { console.log(SB); },\n      setFilters: (filters) => { console.log(filters); },\n    };\n  };\n  // Get current path of script by triggering a stack trace\n  /*! @source https://gist.github.com/eligrey/5426730 */\n  window.StockSearchBar.PATH = (() => {\n    const filename = 'fileName';\n    const stack = 'stack';\n    const stacktrace = 'stacktrace';\n    const sourceUrl = 'sourceURL';\n    const current = 'currentScript';\n    let loc = null;\n    const matcher = (name, matchedLoc) => {\n      loc = matchedLoc;\n    };\n\n    // for modern browsers\n    if (document[current] && document[current].src !== '') {\n      loc = document[current].src;\n      return loc.slice(0, loc.lastIndexOf('/') + 1);\n    }\n\n    try {\n      0(); // throws error\n      return false;\n    } catch (ex) {\n      if (filename in ex) { // Firefox\n        loc = ex[filename];\n      } else if (sourceUrl in ex) { // New Safari\n        loc = ex[sourceUrl];\n      } else if (stacktrace in ex) { // Opera\n        ex[stacktrace].replace(/called from line \\d+, column \\d+ in (.*):/gm, matcher);\n      } else if (stack in ex) { // WebKit, Blink, and IE10\n        ex[stack].replace(/at.*?\\(?(\\S+):\\d+:\\d+\\)?$/g, matcher);\n      }\n      return loc.slice(0, loc.lastIndexOf('/') + 1);\n    }\n  })();\n\n  // notifies main script when everything is loaded\n  function jqLoaded() {\n    // get current path of script\n    const includePath = window.StockSearchBar.PATH;\n    jQuery(document).ready((jQuery) => {\n      const SS = window.StockSearchBar;\n      SS.$jq = jQuery.noConflict();\n      const $jq = SS.$jq;\n      const reqs = {\n        keywordx: 'keywordx.min.js',\n        imagesloaded: 'imagesloaded.pkgd.min.js',\n        adobestocklib: 'adobestocklib.min.js',\n        masonry: 'masonry.pkgd.min.js',\n      };\n      // load other libraries using a promise\n      // https://stackoverflow.com/a/11803418/9421005\n      $jq.when(\n        $jq.getScript(`${includePath}${reqs.adobestocklib}`),\n        $jq.getScript(`${includePath}${reqs.masonry}`),\n        $jq.getScript(`${includePath}${reqs.imagesloaded}`),\n        $jq.getScript(`${includePath}${reqs.keywordx}`),\n        $jq.Deferred((deferred) => {\n          $jq(deferred.resolve);\n        }),\n      ).done(() => {\n        console.log('jQuery %s and all libraries loaded.', $jq().jquery);\n        // dispatch event that searchbar is ready to load\n        SS.keywordx = window.keywordx;\n        SS.Masonry = window.Masonry;\n        const event = new Event('StockSearchBarReady');\n        // Dispatch the event.\n        window.dispatchEvent(event);\n      }).fail((jqXHR, textStatus, errorThrown) => {\n        console.error(errorThrown);\n      });\n    });\n  }\n\n  const domReadyHandler = (a) => {\n    const b = document;\n    const c = 'addEventListener';\n    if (b[c]) b[c]('DOMContentLoaded', a);\n    else window.attachEvent('onload', a);\n  };\n\n  domReadyHandler(() => {\n    // check for jQuery and load conditionally\n    if (typeof window.jQuery === 'undefined' && !window.jQuery) {\n      const jQ = document.createElement('script');\n      jQ.type = 'text/javascript';\n      jQ.onload = jQ.onreadystatechange;\n      jQ.onload = jqLoaded;\n      jQ.src = `${window.StockSearchBar.PATH}/jquery.min.js`;\n      document.body.appendChild(jQ);\n    } else {\n      jqLoaded();\n    }\n  });\n})();\n"]}